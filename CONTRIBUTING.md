コーディングスタイルと品質に関する規約

本セクションでは、PHP、JavaScriptなどの言語に共通する、具体的な記述スタイルおよびコードの品質に関するルールを定義します。

**1\. スタイルとフォーマットに関する規約**

自動フォーマッタ（PHP CS Fixer, Prettier）の設定を正とし、手動で以下のルールを遵守します。

1.1. インデントと空白

* インデント: すべてのファイルでタブを使用します。スペースキーの使用は禁止です。  
* 括弧:  
  * PHPスタイル: if や for の行と同じ行の末尾に記述します（K\&Rスタイル/PSR-12準拠）。  
* 空白:  
  * 演算子の前後（=、+、==など）には必ず1つの空白を入れます（例：int count \= a \+ b;）。  
  * カンマ（,）の直後には、必ず1つの空白を入れます（例：private void sample (int a, int b)）。  
  * if や for などにおいて、( 直前に空白を入れます（例：if (a \== b) や private void sample (int a, int b)）。

1.2. 命名規則に関する規約

Laravelの規約（PSR-12）と.NETの慣習を組み合わせた、以下の命名規則を適用します。

| 項目 | 命名規則 | PHP (例) | JavaScript (例) |
| :---- | :---- | :---- | :---- |
| クラス名 | パスカルケース (PascalCase) | UserController | AuthService |
| メソッド/関数名 | ローワースネークケース (lower\_snake\_case) | get\_user\_info() | login\_user() |
| 変数/引数 | ローワースネークケース (lower\_snake\_case) | $user\_name | student\_id |
| 定数 | 大文字スネークケース (UPPER\_SNAKE\_CASE) | MAX\_STUDENTS | API\_URL |
| ブール値 | is、can、has、should で開始 | $is\_logged\_in | can\_edit |

ブール値の接頭辞の意味

* is: 状態や条件が成立しているかどうか（例: $is\_active）  
* can: アクションや動作が可能かどうか（例: can\_submit）  
* has: 属性や要素を持っているかどうか（例: has\_permission）  
* should: アクションや動作をすべきかどうか（例: should\_validate）

**2\. 構造と品質に関する規約**

安全で保守性が高く、レビューしやすいコードを目指します。

1. 単一責任の原則 (SRP): メソッドや関数は一つのタスクのみを実行するように設計します。メソッドの行数は最大40行を目安とし、これを超える場合はリファクタリング（関数化やサービス化）を検討します。  
2. マジックナンバーの禁止: 意味を持つ数値（100、3など）は直接コードに記述せず、必ずクラス定数または設定ファイルで定義します。  
3. セキュリティ（DB）: データベースへのすべての操作は、SQLインジェクションを防ぐため、\*\*必ずLaravelのEloquent ORMまたはクエリビルダ（プリペアドステートメント）\*\*を経由させます。生SQLの使用は禁止します。  
4. コメント: コメントは\*\*「何をしているか」ではなく、「なぜそうしているのか」\*\*という意図を明確にするために記述します。PHPDoc（関数/クラスの説明）は必須とします。  
5. 一行の文字数: 原則として最大80文字とします。これを超える場合は、メソッドチェーンの途中や括弧区切りの部分で改行を行い、コードの垂直方向の可読性を高めます。

**3\. エラーハンドリングについての規約**

ユーザー体験とデバッグの容易性を考慮し、エラーは明確に、かつ適切に処理します。

1. エラーメッセージの明確化: エラーメッセージは、何が、どこで、なぜ発生したのかを明確に伝える、わかりやすいものとします。  
2. ハンドリングとログ: ハンドルしたエラーは、まずその場でログやコンソールに表示し、記録します。そのあと必要に応じて上位メソッドにエラーを投げる（throw）ことで、適切な場所で最終処理ができるようにします。  
3. エラーのもみ消しの禁止: エラーが発生した時点でもみ消さず、必ずそのエラーが何かを明確にわかる出力や上位にスローすることを徹底します。  
4. リソースの解放: データベース接続、ファイルストリームなどのリソースの例外処理でエラーが発生した場合、finallyブロックなどを使用して、必ずそのリソースを閉じ（解放し）ます。

**4\. コード設計についての規約**

保守性と拡張性を高めるための設計原則を遵守します。

1. DRY原則の適用: コードの重複は極力回避し、関数化やモジュール化を行い、再使用できるようにします（Don't Repeat Yourself）。  
2. シンプルさの追求: コードはシンプルかつ明確に問題を解決できているかを確認します。複雑なロジックはサービス層に分離します。  
3. マジックナンバーの排除: 判定に直接数値を入力するのではなく、定数を宣言したり、変数を用いたりすることで、それがどのような数字なのかを明確にわかるようにします。

**５．ディレクトリ構成についての規約**

# **ディレクトリ構成に関するコーディング規約 (PHP/HTML/CSS ベース)**

本プロジェクトは、Webサーバーのドキュメントルートを **`public/`** に設定することを前提とします。これにより、Webから直接アクセスされるファイルと、機密性の高いロジックを格納する非公開ファイルが明確に分離されます。

## **1\. セキュリティとロジックの分離**

| ディレクトリ/ファイル | 役割 | 遵守事項 |
| ----- | ----- | ----- |
| **`app/`** | **非公開**：すべてのPHPビジネスロジック、データ処理、認証ロジックを格納します。 | Webサーバーから直接アクセス可能な設定にしてはいけません。`public/` 経由でのみ実行されます。 |
| **`public/`** | **公開**：Webブラウザから直接アクセスされる、静的ファイルとエントリーポイントを格納します。 | Webサーバーの設定で、ドキュメントルートは必ずこのディレクトリに指定します。 |
| **`.env`** | **機密情報**：データベースの認証情報、APIキーなどの環境固有の値を格納します。 | **絶対に`.gitignore`に含め、GitHubにプッシュしないことを徹底します。** |
| **`config/`** | **設定**：データベース接続設定、URLパス、その他の定数を定義します。`.env`の値を読み込みます。 | 機密情報は直接記述せず、`.env`から取得します。 |

### **`app/` ディレクトリ内の規約**

* **`app/Classes/`**: 処理を行うためのPHPクラス（例: `DatabaseConnection.php`, `GoogleAuthHandler.php`）を配置します。  
* **`app/Functions/`**: クラスに属さない、汎用的なPHP関数（例: 文字列整形、バリデーションヘルパー）を配置します。  
* **`app/Templates/`**: PHPでインクルードされる共通部品（ヘッダー、ナビゲーション、フッターなど）を配置します。

## **2\. フロントエンドとアセットの規約**

すべてのフロントエンド関連ファイルは、`public/` ディレクトリ配下に格納します。

| ディレクトリ | 役割 | 遵守事項 |
| ----- | ----- | ----- |
| **`public/index.php`** | **エントリーポイント**：すべてのリクエストはここから始まり、`app/` 内のPHPロジックを呼び出します。 | PHPロジックの記述は極力避け、ルーティングとロジックの呼び出しのみに徹します。 |
| **`public/css`** | CSSファイル | 命名はローワースネークケース（例: `main_style.css`）とし、インデントは規約（タブ）に従います。 |
| **`public/js`** | JavaScriptファイル | 命名はローワースネークケース（例: `timetable_logic.js`）とし、DOM操作ロジックを配置します。 |
| **`public/images`** | Webサイトで使用する画像ファイル | ファイル名を明確にし、必要に応じてサブディレクトリで分類します。 |

## **3\. 依存関係と管理ファイルの規約**

プロジェクトの管理と品質維持に必要なファイルをルートに配置します。

* **`vendor/`**: **Composer**を使用してインストールされた外部ライブラリのすべてを配置します。このディレクトリ内のファイルを直接編集することは禁止します。  
* **`lib/`**: Composerを使用せず、手動で組み込んだ外部ライブラリがある場合に配置します（推奨はComposer利用）。  
* **`tests/`**: PHPUnitなどのテストフレームワークを使用したテストコードを配置します。  
* **`CONTRIBUTING.md`**: チームの**コーディング規約本文**（命名規則、インデント、品質基準など）を記述します。GitHubにプッシュする前に、必ず内容を確認し、更新します。

**6\. セキュリティに関する規約**

すべてのコードにおいて、脆弱性の混入を防ぐためのセキュリティ対策を最優先で実施します。

6.1 入力と出力の検証

1. 入力の検証 (Validation): ユーザーから受け取るすべての入力（フォームデータ、URLパラメータ、APIペイロードなど）は、利用する前に必ずデータ型、長さ、形式を検証（Validate）します。LaravelのValidation機能を利用してください。  
2. 出力のエスケープ (XSS対策): Bladeテンプレートでユーザー提供のデータを表示する際は、必ず二重中括弧 {{ $variable }} を使用し、HTMLエスケープを徹底します。三重中括弧 \!\!\! {\!\! $variable \!\!} \!\!\! の使用は、やむを得ない理由がない限り禁止します。  
3. CSRF対策: 状態を変更する可能性のあるすべてのPOST/PUT/DELETEリクエストのフォームには、必ず @csrf ディレクティブを含めます。

6.2 認証とセッション管理

1. パスワードのハッシュ化: パスワードはプレーンテキスト（平文）でデータベースに保存してはいけません。必ずLaravelのHashファサード（Bcryptアルゴリズム）を利用して、不可逆なハッシュとして保存します。  
2. 認可 (Authorization): ユーザーが特定の操作（更新、削除、閲覧）を実行する前に、そのリソースに対する権限を持っているかを必ず確認します。GateやPolicyといったLaravelの認可機能を利用して実装します。  
3. セッション: セッションIDや認証クッキーは、HTTPS環境下でのみ送信されるように設定します（Laravelのconfig/session.phpでsecureをtrueに設定）。

6.3 サーバーと環境設定

1. 機密情報の隔離: データベースのクレデンシャル、外部APIキー、クライアントシークレットなどは、コードに直接記述せず、必ず\*\*.envファイルに定義\*\*し、config()ヘルパー経由でアクセスします。  
2. エラー情報の制限: 本番環境では、詳細なエラーメッセージ（スタックトレースやデータベース情報を含むもの）をユーザーに表示してはいけません。APP\_DEBUGをfalseに設定することを徹底します。

6.4 依存関係の管理

1. パッケージの選定: プロジェクトに追加するすべての外部ライブラリ（Composer/NPM）は、信頼できるソースからのものか確認し、既知の脆弱性がないかをチェックしてから導入します。  
2. 定期的な更新: 定期的にcomposer updateやnpm updateを実行し、依存関係を最新の状態に保ち、セキュリティパッチを適用します。

